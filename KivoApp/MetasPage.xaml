<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:KivoApp.Models"
             x:Class="KivoApp.MetasPage"
             Title="Metas Financeiras"
             BackgroundColor="#0f1722">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="16">

            <!-- Título -->
            <Label Text="Metas Financeiras"
                   FontSize="28"
                   FontAttributes="Bold"
                   TextColor="White"
                   HorizontalOptions="Center" />

            <!-- Campos para adicionar meta -->
            <Border StrokeShape="RoundRectangle 10"
                    BackgroundColor="#071021"
                    Padding="8,4"
                    StrokeThickness="0">
                <Entry x:Name="DescricaoEntry"
                       Placeholder="Descrição da meta"
                       PlaceholderColor="#888888"
                       TextColor="White"
                       BackgroundColor="Transparent"
                       HeightRequest="45"/>
            </Border>

            <Border StrokeShape="RoundRectangle 10"
                    BackgroundColor="#071021"
                    Padding="8,4"
                    StrokeThickness="0">
                <Entry x:Name="ValorAlvoEntry"
                       Placeholder="Valor alvo (R$)"
                       PlaceholderColor="#888888"
                       TextColor="White"
                       BackgroundColor="Transparent"
                       TextChanged="ValorAlvoEntry_TextChanged"
                       HeightRequest="45"/>
            </Border>

            <Border StrokeShape="RoundRectangle 10"
                    BackgroundColor="#071021"
                    Padding="4"
                    StrokeThickness="0">
                <DatePicker x:Name="DataMetaPicker"
                            TextColor="White"
                            BackgroundColor="Transparent"
                            HeightRequest="45"/>
            </Border>

            <Button Text="Salvar Meta"
                    Clicked="SalvarMeta_Clicked"
                    BackgroundColor="#071021"
                    TextColor="White"
                    CornerRadius="10"
                    HeightRequest="50"
                    FontAttributes="Bold"/>

            <!-- Lista de metas -->
            <CollectionView ItemsSource="{Binding ListaMetas}"
                            SelectionMode="None">

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Meta">
                        <Border
                            Stroke="#374151"
                            StrokeThickness="1"
                            BackgroundColor="#0b1220"
                            StrokeShape="RoundRectangle 12"
                            Padding="14"
                            Margin="0,10">

                            <Grid ColumnDefinitions="*,Auto"
                                  VerticalOptions="Center">

                                <!-- Informações da meta -->
                                <VerticalStackLayout
                                    Grid.Column="0"
                                    Spacing="3"
                                    VerticalOptions="Center"
                                    HorizontalOptions="Fill">

                                    <Label Text="{Binding Descricao}"
                                           FontSize="18"
                                           FontAttributes="Bold"
                                           TextColor="White"/>

                                    <Label Text="{Binding ValorAtual, StringFormat='Atual: {0:C}'}"
                                           TextColor="#4CAF50"/>

                                    <Label Text="{Binding ValorAlvo, StringFormat='Alvo: {0:C}'}"
                                           TextColor="#3B82F6"/>

                                    <Label Text="{Binding Progresso}"
                                           TextColor="#93C5FD"/>

                                    <ProgressBar Progress="{Binding Porcentagem}"
                                                 HeightRequest="5"
                                                 ProgressColor="#4CAF50"
                                                 BackgroundColor="#071021"/>

                                    <Label Text="{Binding DataMeta, StringFormat='Data: {0:dd/MM/yyyy}'}"
                                           FontSize="12"
                                           TextColor="#cbd5e1"/>
                                </VerticalStackLayout>

                                <!-- Botão de exclusão -->
                                <Border Grid.Column="1"
                                        BackgroundColor="Transparent"
                                        HeightRequest="50"
                                        WidthRequest="50"
                                        HorizontalOptions="Center"
                                        VerticalOptions="Center"
                                        StrokeThickness="0">
                                    <ImageButton Source="trash.png"
                                                 HeightRequest="50"
                                                 WidthRequest="50"
                                                 BackgroundColor="Transparent"
                                                 Padding="0"
                                                 Clicked="ExcluirMeta_Clicked"
                                                 CommandParameter="{Binding .}" />
                                </Border>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
