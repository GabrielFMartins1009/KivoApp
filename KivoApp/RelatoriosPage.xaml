<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:services="clr-namespace:KivoApp.Services"
             xmlns:converters="clr-namespace:KivoApp.Converters"
             xmlns:microcharts="clr-namespace:Microcharts.Maui;assembly=Microcharts.Maui"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             x:Class="KivoApp.RelatoriosPage"
             Title="Relatórios"
             BackgroundColor="{StaticResource BackgroundColor}">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <!-- Título -->
            <Label Text="Relatórios" FontSize="28" FontAttributes="Bold"
                   TextColor="{StaticResource TextPrimaryColor}" HorizontalOptions="Start" />

            <!-- Cards de Totais -->
            <Grid ColumnDefinitions="Auto,Auto,Auto" ColumnSpacing="15">
                <Border Padding="15" StrokeShape="RoundRectangle 12" Background="{StaticResource CardColor}" HorizontalOptions="Fill">
                    <VerticalStackLayout HorizontalOptions="Fill" Spacing="5">
                        <Label Text="Entradas" FontSize="14" TextColor="Green"/>
                        <Label x:Name="EntradasLabel" Text="R$ 0,00" FontSize="20" FontAttributes="Bold"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"/>
                    </VerticalStackLayout>
                </Border>

                <Border Padding="15" StrokeShape="RoundRectangle 12" Background="{StaticResource CardColor}" HorizontalOptions="Fill">
                    <VerticalStackLayout HorizontalOptions="Fill" Spacing="5">
                        <Label Text="Saídas" FontSize="14" TextColor="Red"/>
                        <Label x:Name="SaidasLabel" Text="R$ 0,00" FontSize="20" FontAttributes="Bold"
                               LineBreakMode="NoWrap"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"/>
                    </VerticalStackLayout>
                </Border>

                <Border Padding="15" StrokeShape="RoundRectangle 12" Background="{StaticResource CardColor}" HorizontalOptions="Fill">
                    <VerticalStackLayout HorizontalOptions="Fill" Spacing="5">
                        <Label Text="Saldo" FontSize="14" TextColor="{StaticResource Primary}"/>
                        <Label x:Name="SaldoLabel" Text="R$ 0,00" FontSize="20" FontAttributes="Bold"
                               LineBreakMode="NoWrap"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"/>
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <!-- Filtro por tipo -->
            <Label Text="Filtrar por tipo:"
                   FontSize="16"
                   FontAttributes="Bold"
                   TextColor="{StaticResource TextPrimaryColor}" />

            <Picker x:Name="TipoPicker"
                    Title="Selecione"
                    SelectedIndexChanged="OnTipoPickerChanged"
                    BackgroundColor="{StaticResource CardColor}"
                    TextColor="{StaticResource TextPrimaryColor}">
                <Picker.Items>
                    <x:String>Todas</x:String>
                    <x:String>Entradas</x:String>
                    <x:String>Saídas</x:String>
                </Picker.Items>
            </Picker>

            <!-- Filtro por período -->
            <Label Text="Filtrar por período:"
                   FontSize="16"
                   FontAttributes="Bold"
                   TextColor="{StaticResource TextPrimaryColor}" />

            <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                <VerticalStackLayout>
                    <Label Text="De:" FontSize="14" TextColor="{StaticResource TextSecondaryColor}" />
                    <DatePicker x:Name="DataInicioPicker"
                                Date="{x:Static sys:DateTime.Now}"
                                MaximumDate="{x:Static sys:DateTime.Now}"
                                DateSelected="OnDataFiltroChanged"
                                BackgroundColor="{StaticResource CardColor}"
                                TextColor="{StaticResource TextPrimaryColor}" />
                </VerticalStackLayout>

                <VerticalStackLayout Grid.Column="1">
                    <Label Text="Até:" FontSize="14" TextColor="{StaticResource TextSecondaryColor}" />
                    <DatePicker x:Name="DataFimPicker"
                                Date="{x:Static sys:DateTime.Now}"
                                MaximumDate="{x:Static sys:DateTime.Now}"
                                DateSelected="OnDataFiltroChanged"
                                BackgroundColor="{StaticResource CardColor}"
                                TextColor="{StaticResource TextPrimaryColor}" />
                </VerticalStackLayout>
            </Grid>

            <!-- Histórico -->
            <Label Text="Histórico" FontSize="20" FontAttributes="Bold"
                   TextColor="{StaticResource TextPrimaryColor}" Margin="0,20,0,10"/>

            <CollectionView x:Name="HistoricoCollectionView">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border StrokeShape="RoundRectangle 12" Background="{StaticResource CardColor}" Padding="10" Margin="0,0,0,10">
                            <Grid ColumnDefinitions="*,Auto,Auto">
                                <Label Text="{Binding Descricao}" FontSize="16" TextColor="{StaticResource TextPrimaryColor}" />
                                <Label Text="{Binding Valor, StringFormat='R$ {0:N2}'}" FontSize="16"
                                       TextColor="{Binding Tipo, Converter={StaticResource TipoToColorConverter}}"
                                       Grid.Column="1" HorizontalOptions="End"/>
                                <Label Text="{Binding Data, StringFormat='{0:dd/MM/yyyy}'}" FontSize="14"
                                       TextColor="{StaticResource TextSecondaryColor}"
                                       Grid.Column="2" HorizontalOptions="End" Margin="10,0,0,0"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Gráfico -->
            <Label Text="Gráfico dos últimos 30 dias" FontSize="20" FontAttributes="Bold"
                   TextColor="{StaticResource TextPrimaryColor}" Margin="0,20,0,10"/>

            <microcharts:ChartView x:Name="chartView"
                                   HeightRequest="250"/>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
